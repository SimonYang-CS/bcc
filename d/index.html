<!DOCTYPE html>
<!-- saved from url=(0117)https://docs.google.com/document/d/1W83ME5JecI2hd5hAUqQ1BVF32wtCel8zxb7WPq-D4f8/mobilebasic?urp=gmail_link&gxids=7628 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>b</title><link rel="shortcut icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"><meta name="referrer" content="strict-origin-when-cross-origin"><style nonce="">
html {
  overflow: auto;
}
body {
  margin: 0;
  overflow: hidden;
  word-wrap: break-word;
}
.app-container {
  height: 100%;
  /* Height of mobileweb header + 1 px vertical shadow. */
  margin-top: 57px;
  overflow: auto;
}
.doc {
  padding: 20px 12px 0 12px;
  position: relative;
}
</style><style>
.docs-ml-noselect{-webkit-touch-callout:none;-webkit-user-drag:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.docs-ml-promotion{z-index:1002}.docs-ml-header{z-index:1}.docs-ml-icon{direction:ltr;display:inline-block;text-align:left;overflow:hidden;position:relative;vertical-align:middle}.docs-ml-img:before{content:url("//ssl.gstatic.com/docs/common/mobileweb_sprite1.png")}.docs-ml-img-container{height:156px;position:absolute;width:36px}.docs-ml-docs-logo-icon{left:0;top:-36px}.docs-ml-sheets-logo-icon{left:0;top:0}.docs-ml-slides-logo-icon{left:0;top:-96px}.docs-ml-arrow-back-icon{left:0;top:-132px}.docs-ml-edit-icon{left:0;top:-72px}@media screen and (-webkit-min-device-pixel-ratio:2.0){.docs-ml-img{content:url(//ssl.gstatic.com/docs/common/mobileweb_sprite1.png)}.docs-ml-img-container{height:156px;position:absolute;width:36px}.docs-ml-docs-logo-icon{left:0;top:-36px}.docs-ml-sheets-logo-icon{left:0;top:0}.docs-ml-slides-logo-icon{left:0;top:-96px}.docs-ml-arrow-back-icon{left:0;top:-132px}.docs-ml-edit-icon{left:0;top:-72px}}.docs-ml-header{background:#fafafa;border-bottom:1px solid #cbcbcb;box-shadow:0 1px 1px rgba(0,0,0,.1);-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;font-family:Roboto,"Helvetica Neue",Helvetica,Arial,sans-serif;padding:4px 0;position:fixed;left:0;top:0;width:100%}.docs-ml-header-icon{height:24px;opacity:0.6;width:24px}.docs-ml-header-icon-container{padding:12px}.docs-ml-header-item{display:inline-block;vertical-align:middle}.docs-ml-header-drive-link{padding-left:4px}body[dir="rtl"] .docs-ml-arrow-back-dir{-webkit-transform:scaleX(-1);-moz-transform:scaleX(-1);-ms-transform:scaleX(-1);-o-transform:scaleX(-1);transform:scaleX(-1)}.docs-ml-header-document-title{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;line-height:24px;padding:0 12px;width:60%;width:calc(100% - 104px)}.docs-ml-header-document-title-text{font-size:20px;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.docs-ml-header-edit-button{float:right;padding-right:4px}.docs-ml-promotion{background:white;bottom:0;box-shadow:0 4px 12px rgba(0,0,0,0.4);font-family:Arial,Helvetica,sans-serif;left:0;position:fixed;width:100%}.docs-ml-promotion-off-screen{-webkit-transform:translateY(100%);-moz-transform:translateY(100%);-ms-transform:translateY(100%);-o-transform:translateY(100%);transform:translateY(100%)}.docs-ml-promotion-shown{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);-o-transform:translateY(0);transform:translateY(0);-webkit-transition:-webkit-transform 333ms cubic-bezier(0.4,0.0,0.2,1);transition:transform 333ms cubic-bezier(0.4,0.0,0.2,1)}.docs-ml-promotion-dismissed{-webkit-transform:translateY(100%);-moz-transform:translateY(100%);-ms-transform:translateY(100%);-o-transform:translateY(100%);transform:translateY(100%);box-shadow:none}.docs-ml-promotion-no-horizontal-scroll{overflow-x:hidden}.docs-ml-promotion-header{display:table;padding:24px 24px 0 24px}.docs-ml-promotion-app-icon-container{display:table-cell}.docs-ml-promotion-app-icon{height:36px;width:36px}@media (min-width:600px){.docs-ml-promotion-app-icon{-webkit-transform:scale(1.33);-moz-transform:scale(1.33);-ms-transform:scale(1.33);-o-transform:scale(1.33);transform:scale(1.33)}}.docs-ml-promotion-text{display:table-cell;padding-left:20px;vertical-align:top}.docs-ml-promotion-text-heading{color:rgba(0,0,0,0.87);font-size:16px;font-weight:bold;padding-bottom:7px}.docs-ml-promotion-text-body{color:rgba(0,0,0,0.87);font-size:14px}.docs-ml-promotion-action-row{float:right;margin-top:6px;padding:8px 24px}.docs-ml-promotion-action-row-desktop{margin-top:6px}.docs-ml-promotion-action-container{display:inline-block;height:48px;margin:6px 4px;vertical-align:middle}.docs-ml-promotion-action-button{display:inline-block;font-size:14px;font-weight:500;padding:9px 12px;vertical-align:middle}.docs-ml-promotion-action-button-wrapper:focus{outline-color:#d6d6d6}.docs-ml-promotion-action-button.docs-ml-promotion-yes-button{background-color:#4285f4;border-radius:4px;color:#fafafa;border:1px solid transparent}.docs-ml-promotion-action-button.docs-ml-promotion-yes-button:active{background-color:#1967d2}.docs-ml-promotion-action-button.docs-ml-promotion-no-button{background-color:#fafafa;color:#5f6368;border-radius:4px;border:1px solid #dadce0}.docs-ml-promotion-action-button.docs-ml-promotion-no-button:active{background-color:#f5f5f5}.docs-ml-promotion.desktop{text-align:center}@media (orientation:portrait){.docs-ml-promotion.desktop{padding-top:56px;padding-bottom:80px}}@media (orientation:landscape){.docs-ml-promotion.desktop{padding-top:36px;padding-bottom:56px}}.docs-ml-promotion-heading-desktop{font-family:'Google Sans';font-size:18px;font-weight:bold;color:#202124;padding-top:18px;padding-bottom:10px;line-height:1.5;max-width:360px;margin:0px auto}@media (orientation:landscape){.docs-ml-promotion-heading-desktop{padding-top:0px;max-width:none}}.docs-ml-promotion-text-body-desktop{font-size:14px;line-height:1.5;color:#5f6368;padding-bottom:10px}.docs-icon.docs-ml-promotion-desktop-icon{height:40px;width:40px;-webkit-transform:scale(2.5);-moz-transform:scale(2.5);-ms-transform:scale(2.5);-o-transform:scale(2.5);transform:scale(2.5);-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;-o-transform-origin:top;transform-origin:top}.docs-icon-ml-promotion-icon-container-desktop{height:100px;width:100px;margin-left:auto;margin-right:auto}@media (orientation:landscape){.docs-icon-ml-promotion-icon-container-desktop{display:inline-block;vertical-align:top}.docs-ml-promotion-description-desktop{display:inline-block;vertical-align:top;text-align:left;padding-left:39px;max-width:645px}}@media (orientation:landscape){.docs-ml-promotion-action-row-desktop{margin-left:-8px}}.docs-ml-promotion-action-row-desktop .docs-ml-promotion-action-container{margin:6px 8px;font-family:'Google Sans'}.docs-ml-promotion-action-row-desktop .docs-ml-promotion-action-button-wrapper:focus{outline:none}.docs-ml-promotion-action-button.docs-ml-promotion-yes-button.docs-ml-promotion-app-themed{background-image:none;border:1px solid transparent!important;border-radius:4px;box-shadow:none;box-sizing:border-box;font-family:"Google Sans",Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-weight:500;font-size:14px;height:36px;letter-spacing:0.25px;line-height:16px;padding:9px 24px 11px 24px;background:#1a73e8;color:#fff}.docs-ml-promotion-action-button.docs-ml-promotion-yes-button.docs-ml-promotion-app-themed:active{background-image:none;border:1px solid transparent!important;border-radius:4px;box-shadow:none;box-sizing:border-box;font-family:"Google Sans",Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-weight:500;font-size:14px;height:36px;letter-spacing:0.25px;line-height:16px;padding:9px 24px 11px 24px;background:#1a73e8;color:#fff}.docs-ml-promotion-action-button.docs-ml-promotion-no-button.docs-ml-promotion-app-themed{background-image:none;border:1px solid transparent!important;border-radius:4px;box-shadow:none;box-sizing:border-box;font-family:"Google Sans",Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-weight:500;font-size:14px;height:36px;letter-spacing:0.25px;line-height:16px;padding:9px 24px 11px 24px;background:white;border:1px solid #dadce0!important;color:#1a73e8}.docs-ml-promotion-action-button-wrapper:focus .docs-ml-promotion-action-button.docs-ml-promotion-yes-button.docs-ml-promotion-app-themed{background-image:none;border:1px solid transparent!important;border-radius:4px;box-shadow:none;box-sizing:border-box;font-family:"Google Sans",Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-weight:500;font-size:14px;height:36px;letter-spacing:0.25px;line-height:16px;padding:9px 24px 11px 24px;background:#1a73e8;color:#fff;background:#5094ed;box-shadow:0 1px 3px 1px rgba(66,133,244,0.15)}.docs-ml-promotion-action-button-wrapper:focus .docs-ml-promotion-action-button.docs-ml-promotion-no-button.docs-ml-promotion-app-themed{background-image:none;border:1px solid transparent!important;border-radius:4px;box-shadow:none;box-sizing:border-box;font-family:"Google Sans",Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-weight:500;font-size:14px;height:36px;letter-spacing:0.25px;line-height:16px;padding:9px 24px 11px 24px;background:#e9f1fe;border:1px solid #c1d8fb!important}</style><script nonce="">_docs_flag_initialData={"docs-mwid":true,"docs-smheo":false,"info_params":{"token":"AC4w5VjqtTIgxtORviGkG9xGENAkKPmQfQ:1602552728412","includes_info_params":true},"ilcm":{"eui":"ADFN-cuyQzMmJhAgXWh2_1ktfhN8QMdu7Okmrf-9B86C4rMfVW1DRMkChpe1NMHhtGHlohjwN6oU","je":1,"sstu":1602552728424000,"si":"CIKg8pC2sOwCFZcnsAodxbIKlA","gsc":2,"ei":[5700884,5703295,5700394,5710645,5710367,5708826,5700893,5715349,5704883,5705279,5707445,5709900,5703182,5703762,5710863,5705255,5718053,5713211,5708928,5708703,5700960,5708870,5711929,5713554,5704572,5705809,5711155,5710929,5704561,5711297,5706311,5710806,5704144,5710768,5710921,5706993,5711230,5700042,5708361,5705689,5707832,5703319,5711550,5703913,5702320,5707204,5713049,5704039,5706581,5703757,5704003,5712373,5708365,5714447,5709466,5709876,5709653,5703283,5709197,5702785,5710181,5711056,5706270,5705585,5704907,5707957,5705793,5707986,5705841,5713605,5702511,5707711,5704520,5717093,5714961,5700446,5703579,5711254,5707335,5707361,5702912,5700136,5709443,5706601,5708687,5705895,5709014,5711708,5704581,5712905,5707425,5707733,5703422,5706499,5700016,5701578,5700032,5713191,5714932,5715791,5711248,5715270,5707605,5703815,5711925,5703451,5702402,5701594,5711866,5703839,5708862,5703022,5713195,5700057,5712415,5712141,5702023,5706286,5703186,5704641,5705597,5706210,5700261,5713633,5712917,5702445,5710790,5712394,5711563,5700333,5705545,5713227,5713997,5700019,5701034,5710567,5707941,5715115,5706055,5707657,5712256,5706621,5706747,5705047,5711546,5705581,5703028,5705625,5711210,5706786,5701586,5715222,5700103,5704851,5704905,5710720,5709447,5715584,5703954,5708564,5702706,5709476,5716153,5702340,5708309,5704063,5707165,5700114,5710587,5711389,5715517,5707047,5701650,5703190,5709906,5709106,5711937,5713152,5706933,5712913,5707075,5700933,5708163,5701461,5709411,5713622,5703307,5713207,5711808,5704444,5715286,5706523,5712067,5701143,5712332,5700187,5710492,5704661,5711850,5711078,5709776,5700611,5706423,5707819,5714628,5707581,5712137,5711524,5703888,5707649,5704729,5714552,5708349,5704859,5710771,5706359,5715641,5711677,5712360,5708886,5711685],"crc":1,"cvi":[3300004,3300107,3300131,3300164,3313321,3316377,3318773,3318887,3318889,3319459,3320540,3320770,3320862,3329021]},"drive_url":"//drive.google.com/u/0?usp\u003ddocs_web","docs-sup":"/document/u/0"}; _docs_flag_cek='KXCsOZmVbUTcY6cX7fzR6g\x3d\x3d'; if (window['DOCS_timing']) {DOCS_timing['ifdld']=new Date().getTime();}</script></head><body>
<script type="text/javascript" nonce="">if ((! false  && !this['DOCS_initDocsMobileWeb']) ||  false ) {if (window.navigator && window.navigator.sendBeacon) {window.navigator.sendBeacon('\/document\/u\/0\/jserror?jobset\x3dprod\x26error\x3dJS+binary+load+failure&context.functionName=DOCS_initDocsMobileWeb\x26context.actionName\x3dMobileBasic');}(window.location.href = 'https:\/\/support.google.com\/accounts\/answer\/32050')}DOCS_initDocsMobileWeb( true ,  true , 'b', 'intent:\/\/docs.google.com\/document\/d\/1W83ME5JecI2hd5hAUqQ1BVF32wtCel8zxb7WPq-D4f8\/edit#Intent;scheme\x3dhttps;package\x3dcom.google.android.apps.docs.editors.docs;S.browser_fallback_url\x3dmarket:\/\/details?id\x3dcom.google.android.apps.docs.editors.docs;end', 'googledocs:\/\/docs.google.com\/document\/u\/0\/d\/1W83ME5JecI2hd5hAUqQ1BVF32wtCel8zxb7WPq-D4f8\/edit',  false );</script><div id="docs-ml-header-id" class="docs-ml-header"><span class="docs-ml-header-item docs-ml-header-drive-link"><div id="docs-ml-header-drive-link-aria-label" style="display:none;">Go to Drive</div><a href="https://drive.google.com/u/0?usp=docs_web" aria-labelledby="docs-ml-header-drive-link-aria-label" role="button"><div class="docs-ml-header-icon-container"><div class="docs-ml-icon docs-ml-header-icon docs-ml-arrow-back-dir"><div class="docs-ml-img-container docs-ml-img docs-ml-arrow-back-icon"></div></div></div></a></span><span class="docs-ml-header-item docs-ml-header-document-title"><div class="docs-ml-header-document-title-text">b</div></span></div><div class="app-container"><div class="doc-container"><div class="doc"><style type="text/css"> @import url(https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw); ul.lst-kix_np04nh9dmrtq-2{list-style-type:none}ul.lst-kix_np04nh9dmrtq-3{list-style-type:none}ul.lst-kix_np04nh9dmrtq-0{list-style-type:none}ul.lst-kix_np04nh9dmrtq-1{list-style-type:none}ul.lst-kix_np04nh9dmrtq-8{list-style-type:none}ul.lst-kix_np04nh9dmrtq-6{list-style-type:none}ul.lst-kix_np04nh9dmrtq-7{list-style-type:none}ul.lst-kix_np04nh9dmrtq-4{list-style-type:none}ul.lst-kix_np04nh9dmrtq-5{list-style-type:none}ul.lst-kix_a3lryeihpqre-1{list-style-type:none}ul.lst-kix_a3lryeihpqre-0{list-style-type:none}ul.lst-kix_a3lryeihpqre-5{list-style-type:none}.lst-kix_a3lryeihpqre-0 > li:before{content:"●  "}ul.lst-kix_a3lryeihpqre-4{list-style-type:none}ul.lst-kix_a3lryeihpqre-3{list-style-type:none}ul.lst-kix_a3lryeihpqre-2{list-style-type:none}ul.lst-kix_a3lryeihpqre-8{list-style-type:none}ul.lst-kix_a3lryeihpqre-7{list-style-type:none}ul.lst-kix_a3lryeihpqre-6{list-style-type:none}.lst-kix_a3lryeihpqre-4 > li:before{content:"○  "}.lst-kix_a3lryeihpqre-5 > li:before{content:"■  "}.lst-kix_tksont54az5u-0 > li:before{content:"●  "}.lst-kix_tksont54az5u-1 > li:before{content:"○  "}.lst-kix_tksont54az5u-3 > li:before{content:"●  "}.lst-kix_a3lryeihpqre-1 > li:before{content:"○  "}.lst-kix_tksont54az5u-2 > li:before{content:"■  "}.lst-kix_tksont54az5u-4 > li:before{content:"○  "}.lst-kix_a3lryeihpqre-2 > li:before{content:"■  "}.lst-kix_a3lryeihpqre-3 > li:before{content:"●  "}.lst-kix_tksont54az5u-7 > li:before{content:"○  "}.lst-kix_tksont54az5u-6 > li:before{content:"●  "}.lst-kix_tksont54az5u-8 > li:before{content:"■  "}.lst-kix_tksont54az5u-5 > li:before{content:"■  "}.lst-kix_a3lryeihpqre-8 > li:before{content:"■  "}.lst-kix_a3lryeihpqre-6 > li:before{content:"●  "}.lst-kix_a3lryeihpqre-7 > li:before{content:"○  "}.lst-kix_np04nh9dmrtq-2 > li:before{content:"■  "}.lst-kix_np04nh9dmrtq-0 > li:before{content:"●  "}.lst-kix_np04nh9dmrtq-1 > li:before{content:"○  "}.lst-kix_np04nh9dmrtq-3 > li:before{content:"●  "}ul.lst-kix_tksont54az5u-4{list-style-type:none}ul.lst-kix_tksont54az5u-5{list-style-type:none}.lst-kix_np04nh9dmrtq-4 > li:before{content:"○  "}.lst-kix_np04nh9dmrtq-5 > li:before{content:"■  "}ul.lst-kix_tksont54az5u-6{list-style-type:none}ul.lst-kix_tksont54az5u-7{list-style-type:none}ul.lst-kix_tksont54az5u-0{list-style-type:none}ul.lst-kix_tksont54az5u-1{list-style-type:none}.lst-kix_np04nh9dmrtq-6 > li:before{content:"●  "}ul.lst-kix_tksont54az5u-2{list-style-type:none}ul.lst-kix_tksont54az5u-3{list-style-type:none}.lst-kix_np04nh9dmrtq-8 > li:before{content:"■  "}ul.lst-kix_tksont54az5u-8{list-style-type:none}.lst-kix_np04nh9dmrtq-7 > li:before{content:"○  "}</style><p class="title" id="h.moseg6gryxz1" style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:26pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:&quot;Arial&quot;;font-style:normal">kparc.com/b/</span></p><p class="subtitle" id="h.zfc0fk9wfqz6" style="padding-top:0pt;margin:0;color:#666666;padding-left:0;font-size:15pt;padding-bottom:16pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;height:10pt;text-align:left;padding-right:0"><span style="color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:15pt;font-family:&quot;Arial&quot;;font-style:normal"></span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;line-height:1.15;font-family:&quot;Arial&quot;;orphans:2;widows:2;height:10pt;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal"></span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">I have been studying this code for a while and I think I have understood most of it, although in general I am quite far of my comfort zone. I find it fascinating. It is terse code, not your typical C, that’s for sure, but beautiful in its own way. It makes use of several clever tricks that are not what I would call self-explanatory. I hope the following notes help other interested people. </span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Although authorship is not mentioned anywhere, several references indicate that the code in kparc.com/b/ was written by Arthur Whitney. It seems to be his style. Love it or hate it. </span></p><h1 id="h.eszrgdxbcrr" style="padding-top:20pt;margin:0;color:#000000;padding-left:0;font-size:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:&quot;Arial&quot;;font-style:normal">Introduction</span></h1><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The following files define an interpreter for a language called b, isomorphic to C. When compiled with the k.c file instead of b.c, you would obtain the k interpreter. Unfortunately, the k.c file is not publicly available.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span>In the </span><span style="text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline"><a href="https://www.google.com/url?q=https://www.google.com/url?q%3Dhttp://www.kparc.com/b/readme.txt%26amp;sa%3DD%26amp;ust%3D1602556328215000%26amp;usg%3DAOvVaw0j5IjzlEbiwgkp9DLSnd3c&amp;sa=D&amp;ust=1602556328365000&amp;usg=AFQjCNFBISFX9Rd8EeKyF6QeLbvBurqU7A" style="color:inherit;text-decoration:inherit">readme file</a></span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">, these notes are included:</span></p><a id="t.c469814704288fe34791a639348441b06b7ef616"></a><a id="t.0"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">A.S kernel </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">interface</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">(map unmap ..)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>a.c replaces </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">libc</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">(fp </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">and</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&nbsp;pf need more work)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"><br>b.c compiles b code</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Additionally, the c.h file defines some macros to write C in a terser manner, and a.h is the header file that accompanies a.c. There are also some test files included in C and b (t.c and t.b) and a Makefile.</span></p><h1 id="h.8a5an3rh4w6q" style="padding-top:20pt;margin:0;color:#000000;padding-left:0;font-size:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:&quot;Arial&quot;;font-style:normal">c.h</span></h1><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Included by a.h, this file consists of some basic definitions for a terser C language.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Single letters for common types:</span></p><a id="t.0c8c5097d4251fc4c56d7229408e7ef500952653"></a><a id="t.1"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">typedef</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">unsigned</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">char</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;C,*S,*K;<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">typedef</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">int</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;I;<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">typedef</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">long</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;J;<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">typedef</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">double</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;F;<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">typedef</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">void</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp;V;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Z is added for static types. For static inline, a preceding _ is used (why not either a Z for static or define _I, _J, and so on?):</span></p><a id="t.04289e3a0784e96276b9fd2b26f6c7b4404ffc79"></a><a id="t.2"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZI static I</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZC static C</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZS static S</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZJ static J</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZF static F</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZK static K</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define ZV static V</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define _ static inline</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Control statements are replaced by single letter macros:</span></p><a id="t.3daee1ffe7a5ebf78b9f1b75f0e8f581a8e0ddea"></a><a id="t.3"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define R return</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define P(b,a...) &nbsp; if(b)return(a);</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define N(n,a...) &nbsp; {I i=0,_n=(n);while(i&lt;_n){a;++i;}}</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define W(b...) &nbsp; &nbsp; while((b)) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//while</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define $(b,a...) &nbsp; if(b){a;}else &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//cond</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define C(i,a...) &nbsp; case i:{a;}break; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//case</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define S(i,c,a...) switch(i){c default:a;} </span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">//switch</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Signatures of built-in functions:</span></p><a id="t.27b79db08674203650b1e8e71967131447365882"></a><a id="t.4"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">V*</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">memcpy()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br>J </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">strlen(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">const</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">char</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">*)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Maximum and minimum are also defined as macros, which return a copy of the max or min value:</span></p><a id="t.8c5f0776e4f98e7823ffa9bf5859ec59ecf078e1"></a><a id="t.5"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define MN(a,b) &nbsp; &nbsp;({typeof(a)_a=(a);typeof(a)_b=(b);_a&lt;_b?_a:_b;})<br>#define MX(a,b) &nbsp; &nbsp;({typeof(a)_a=(a);typeof(a)_b=(b);_a&gt;_b?_a:_b;})</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">AB is the abort macro. It uses functions from a.h: os(s) prints the string s and a new line to stdout, exit(1) exits with an error. In case exit fails, (V*)0L will produce a segmentation fault.</span></p><a id="t.2f3be04d51e5556c2e045580ae955b989257a47c"></a><a id="t.6"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define AB(s) &nbsp; &nbsp; &nbsp;(os(s),exit(1),(V*)0L) </span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">//abort string</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><h1 id="h.hivmsnj4laes" style="padding-top:20pt;margin:0;color:#000000;padding-left:0;font-size:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:&quot;Arial&quot;;font-style:normal">A.S</span></h1><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">System calls (read, write, open, close, fstat, mmap, munmap and exit) are called using assembler. The S(n) macro defines a new global name n such that it first moves the content from rcx (4th parameter in function calls) to r10 (4th parameter in syscalls), then sets rax to the desired syscall number (defined in unistd_64.h), makes the syscall, and returns:</span></p><a id="t.1852017e6f237da2775a106554e4f5812373b547"></a><a id="t.7"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#include&lt;asm/unistd_64.h&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define S(n) .globl n;n:;mov %rcx,%r10;mov $__NR_##n,%rax;syscall;ret;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400"><br>S(read)S(write)S(open)S(close)S(fstat)S(mmap)S(munmap)S(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">exit</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">(I find slightly surprising that system calls numbers are taken from the unistd_64.h header file instead of given as integers. I guess it probably is done so to avoid problems with changes between versions, but this is one of the few concessions to defined constants).</span></p><h1 id="h.s7yvd5jexxmq" style="padding-top:20pt;margin:0;color:#000000;padding-left:0;font-size:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:&quot;Arial&quot;;font-style:normal">a.h</span></h1><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Header file for C library (a.c).</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Basically, all values (chars, integers and floats) are of type K (which is a char*). The type of the K value is determined in basis to the following constants:</span></p><a id="t.ce4cf8d3d4167a83e7750d2d9ccbbe2486ca3d81"></a><a id="t.8"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define KC 1L // char</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define KI 3L // int</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define KF 6L // float</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define KS 7L // symbol (char)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Additionally, NL represents a new (not assigned) value, and QQ represents an error string. X2 and X3 are only used in commented code (fixed arrays are used instead in this version of the code):</span></p><a id="t.bdfb9ae7088693f31c5cd7f3994a096012aa43bf"></a><a id="t.9"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define NL (K)(X1&lt;&lt;48)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define X1 11L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define X2 12L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define X3 13L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define QQ 15L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">There are two main kinds of values: unique values and array values.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Unique values are encoded in a single K with the actual type in the first 16 bits (a pointer only uses the last 48 bits), except floats. Floating point numbers in 64 bits use the first 12 bits for the sign and the exponent. The exponent will only be zero for negative zeros and subnormal numbers, but these are not supported, since DAZ (denormal-as-zero) and FTZ (flush to zero) are set at init time (see _start, below).</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Arrays are implemented by adding 8 extra bytes with metadata before the actual array elements: memory (bucket), references, type, unique type, and 4 bytes for array size.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Extern definitions (public interface to C library in a.c):</span></p><a id="t.6c17858109dee9a6eceb3f7d083f0a4137282b2d"></a><a id="t.10"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">extern</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;J nt[],ip();</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">extern</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;K G[],r1(),tn(),j2(),k0(),sS(),enm(),o();V </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">exit()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">w2()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">r0()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pi()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pf()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">px()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;F </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">fp()</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Some other functions are defined as static inlined functions:</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The X function replaces the value pointed to by k with the value in y and returns an empty K value (NL). It decreases the reference counter of the value pointed to by k (with r0, see below), so memory will become available if this was the only reference:</span></p><a id="t.1a02a033b39b5ef858af7e525e0b642e11162b02"></a><a id="t.11"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">X(K*k,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">r0(*k)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,*k=y,NL;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Output functions print to stdout (using the w2 function from a.c) chars (given as integers), newlines, strings (with an added newline), integers, floats and integers in hexadecimal (the last 3 functions use the print functions pi, pf and px, defined in a.c). All these functions (except nl, to print newlines) return the printed value (nb: chars are given and returned as integers):</span></p><a id="t.370dd9ae8ed4aee03d44a6c5439db5817e910bc1"></a><a id="t.12"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">oc(I i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">w2((S)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&amp;i),i;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ V </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">nl()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{w2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"\n"</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">os(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">w2(s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">nl()</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,s;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ J </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">oi(J j)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">os(pi(j)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">),j;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ F </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">of(F f)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">os(pf(f)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">),f;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ J </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ox(J j)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">os(px(j)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">),j;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Scan functions to find, in the string s, a character c and return the pointer, or zero if not found. The function scn limits the search to a number of characters n, and returns this number if c is not found, or the index:</span></p><a id="t.fa7bf9cdbed22f3423cbd548b3c83281069af1fc"></a><a id="t.13"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">sc(S s,I c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{W(*s-c)P(!*s++,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">)R s;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">scn(S s,I c,I n)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">{N(n,P(c==s[i],i))R n;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Next, there are several functions to declare arrays and unique values.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The P1 to P3 functions define default parameters (x, y, z), but it looks like they have been replaced by a fixed array (see struct/fixedarray experiment in a.c):</span></p><a id="t.40b0a050e5c9742feff431b3f1991b33334fd29b"></a><a id="t.14"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//_ K P1(J x){R(K)(X1&lt;&lt;48|x);}</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//_ K P2(J x){R(K)(X2&lt;&lt;48|x);}</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">//_ K P3(J x){R(K)(X3&lt;&lt;48|x);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Array values are declared using tn(t,n), from a.c, which allocates memory for n elements of the type t. The 0 type is used for pointers. An array of pointers is equivalent to a list of arbitrary values:</span></p><a id="t.d0c8ac0f34657b5f4c703d6fdd9d14a51f36ee00"></a><a id="t.15"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kK(I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">tn(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br>_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kC(I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">tn(KC,n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br>_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kI(I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">tn(KI,n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br>_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kS(I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">tn(KS,n)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">These functions create a new char array from a string, either with n chars (pn) or zero terminated (kp):</span></p><a id="t.be8c5bab99e34254427b9ecc097608ecf892f840"></a><a id="t.16"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pn(S s,I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">memcpy(kC(n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">,s,n);}<br>_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kp(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pn(s,strlen(s)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">More functions to work with character arrays: the functions c0, c1, c2 and c3 create char arrays of 0, 1, 2 and 3 characters, respectively; the function jc appends a character c to the char array in x using the j2 function (from a.c), which joins two arrays:</span></p><a id="t.511d7d9be45efca651f81a65c04dc51331f28200"></a><a id="t.17"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c0()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kC(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c1(C x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{K r=kC(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);R*r=x,r;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c2(C x,C y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{K r=kC(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">);R*r=x,r[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">]=y,r;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c3(C x,C y,C z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{K r=kC(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">);R*r=x,r[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">]=y,r[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">]=z,r;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">jc(K x,C c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(x,kc(c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">);}</span></p></td></tr></tbody></table><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal"></span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span>Functions to create new unique values such that the type is stored in the first 16 bits, except for floating point values:.</span></p><a id="t.76f1e0cfb77ae5cb44d84e1473b0fd100c8c056c"></a><a id="t.18"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kc(J x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R(K)(KC&lt;&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">48</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">|x);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ki(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">unsigned</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&nbsp;x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R(K)(KI&lt;&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">48</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">|(J)x);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kf(F f)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">{R*(K*)&amp;f;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ks(J x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R(K)(KS&lt;&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">48</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">|x);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">qs(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R(K)(QQ&lt;&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">48</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">|(J)s);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The A(x) macro will return the type of x if it is a unique value or zero for arrays. I(x) returns the value of a unique integer. Q(x) returns with x if it is an error string, and Qs(c,s) will return s as an error string if the condition c is true. The macro N1 is similar to the macro N, but does a do-while instead of a while loop (why isn’t it defined in c.h?):</span></p><a id="t.81c6d565b3602a2cc1e8f3137cc38c392196603c"></a><a id="t.19"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define A(x) ({J _j=(J)(x);!_j||_j&gt;&gt;52?KF:15&amp;_j&gt;&gt;48;})</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define I(x) (I)(J)(x) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//(-1UL&gt;&gt;16&amp;(J)(x))</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define Q(x) &nbsp; &nbsp; &nbsp; &nbsp;P(QQ==A(x),x)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//#define Q(c,i) &nbsp; &nbsp; &nbsp;P(c,qi(i)) &nbsp;//error index(nyi,rank,length,type,..)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Qs(c,s) &nbsp; &nbsp; P(c,qs(s)) &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//error string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define N1(n,a...) &nbsp;{I i=0,_n=(n);do{a;}while(++i&lt;_n);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The macros Ax and xi are shortcuts for A(x) and I(x), while xf access x as a float value (why isn’t there a F(x) macro?):</span></p><a id="t.b6ee1f61cc768a627a87f94cbc6ae601c108a0b7"></a><a id="t.20"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Ax A(x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xi I(x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define xf *(F*)&amp;x</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span>Array attributes are stored before the actual array values, and therefore accessed with negative indices with the macros xm, xr, xu, xt, xn</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">. The 8 bytes preceding the array elements store the attributes mturnnnn corresponding to memory bucket, type, return value type (for user functions), reference counter, and a 32 bits integer which indicates the size of the array:</span></p><a id="t.900b8286ef089e7d3bf581c113570ee2d080f976"></a><a id="t.21"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xm x[-8] </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//mem</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xr x[-7] </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//ref</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xu x[-6]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xt x[-5]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define xn xI[-1]</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span>The macros xx, xy and xz are used to access the first 3 values in an array of K values, while xI, xF and xK give access to x as an array of integers, floats and K values, respectively (xC is not needed because K values are already defined as a char*). The macros Xc, Xi and Xx allow to access the i-th element of an array of the C, I or K type. Finally, X0(e) returns a copy of e after decreasing the reference counter of x</span><span>:</span></p><a id="t.93f40b15a67d52dffeb78b802876df19339257f6"></a><a id="t.22"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xx xK[0]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xy xK[1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xz xK[2]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xI ((I*)x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xF ((F*)x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define xK ((K*)x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Xc &nbsp;x[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Xi xI[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Xx xK[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define X0(e) &nbsp;({typeof(e)_e=(e);r0(x);_e;})</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">In addition to the above macros that work for the x variables, they are defined for the variables y, z and r. The variables x, y and z usually correspond to function parameters, while r is the return value:</span></p><a id="t.50a89e4f1e6e27fd7fe48cb1a84a23bd7bad5ffe"></a><a id="t.23"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Ay A(y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yi I(y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yu y[-6]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yt y[-5]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yn yI[-1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yx yK[0]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yy yK[1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yI ((I*)y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define yK ((K*)y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Yc &nbsp;y[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Yi yI[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Yx yK[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Y0(e) &nbsp;({typeof(e)_e=(e);r0(y);_e;})</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Az A(z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zi I(z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zu z[-6]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zt z[-5]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zn zI[-1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zx zK[0]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zy zK[1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zI ((I*)z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zF ((F*)z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define zK ((K*)z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Zc &nbsp;z[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Zi zI[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Zx zK[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Z0(e) &nbsp;({typeof(e)_e=(e);r0(z);_e;})</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Ar T(r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ri I(r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rr r[-7]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rt r[-5]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rn rI[-1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rI ((I*)r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rK ((K*)r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rx rK[0]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ry rK[1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define rz rK[2]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Rc &nbsp;r[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Ri rI[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define Rx rK[i]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define R0(e) &nbsp;({typeof(e)_e=(e);r0(r);_e;})</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">In the following macros for function definitions, the letter indicates the return type, with a preceding Z for static functions, and the final number from 1 to 3 indicates the number of arguments:</span></p><a id="t.2868638d7b63518ec2cda6c70cf7361b68ca7f5c"></a><a id="t.24"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZV1(f) ZV f(K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZS1(f) ZK f(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZK1(f) ZK f(K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZK2(f) ZK f(K x,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define ZK3(f) ZK f(K x,K y,K z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define V1(f) &nbsp; V f(K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define I1(f) &nbsp; I f(K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define K1(f) &nbsp; K f(K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">#define K2(f) &nbsp; K f(K x,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">#define K3(f) &nbsp; K f(K x,K y,K z)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#006666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The k1, k2 and k3 functions return an array of K with 1, 2 or 3 values:</span></p><a id="t.b94ba966a0ea4edc44324c609301692d0bc30ae7"></a><a id="t.25"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K1(k1){K r=kK(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);R rx=x,r;}<br>_ K2(k2){K r=kK(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);R rx=x,ry=y,r;}<br>_ K3(k3){K r=kK(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);R rx=x,ry=y,rz=z,r;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">These functions join several elements in a single array (j2, defined in a.c, joins two arrays):</span></p><a id="t.7aae2c08aa270bc9fba82222971d116e0fcc6264"></a><a id="t.26"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">_ K3(j3){R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(j2(x,y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,z);} &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// join 3 K values (x,y,z) in K array </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>_ K2(jk){R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(x,k1(y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);} &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// append y K value to x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>_ K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cj(C c,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(c1(c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y);} </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// prepend c char to y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span></p></td></tr></tbody></table><h1 id="h.o9h2abn19yme" style="padding-top:20pt;margin:0;color:#000000;padding-left:0;font-size:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:&quot;Arial&quot;;font-style:normal">a.c</span></h1><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">This is the C library. It includes basic memory management and I/O functions, as well as functions to help building interpreters.</span></p><h2 id="h.951a6aakd9co" style="padding-top:18pt;margin:0;color:#000000;padding-left:0;font-size:16pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:&quot;Arial&quot;;font-style:normal">Function calls</span></h2><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Signatures of the functions defined in A.S to make system calls:</span></p><a id="t.2713e99b4dfbbc6bfda1df377d56dcd363690a35"></a><a id="t.27"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">J </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">read()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">write()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">open()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">close()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">fstat()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">munmap()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">mmap()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;V </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">exit()</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><h2 id="h.pac2vqr3g7yv" style="padding-top:18pt;margin:0;color:#000000;padding-left:0;font-size:16pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:&quot;Arial&quot;;font-style:normal">Memory allocation and file I/O</span></h2><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Memory is allocated using mmap. The function ma allocates n bytes of memory if d is zero, or maps memory for the file with file descriptor d. The initial memory address used is 0x70000 (I think this is a partially arbitrary choice, just large enough to leave room for the stack in lower addresses). This address will be rounded to the nearest memory page boundary, and it is increased after each allocation (nb: it is kept in a static variable):</span></p><a id="t.14e90e9a9fdb8940cc783bd81987d4df1f64b057"></a><a id="t.28"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ma(I d,J n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{ZJ p=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x700000</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;p+=d?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:n;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">mmap(<br> &nbsp; &nbsp;D?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">:p-n, &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// memory address</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400"><br> &nbsp; &nbsp;n, &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// number of bytes</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">, &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// permissions (rwx)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400"><br> &nbsp; &nbsp;d?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x22</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// flags: 2 for private changes, 0x20 for anonymous (not files)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400"><br> &nbsp; &nbsp;d?d:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">, &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// file descriptor (-1 for anonymous)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// offset is zero</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400"><br>)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Files are also opened using mmap. The string s contains a file name, and the number of bytes (the file size given by fstat) will be stored in n:</span></p><a id="t.0ddd9b0ad5813f958a2f435a2d02e5c7d056397e"></a><a id="t.29"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">mf(S s,J*n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;J b[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">18</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// to store results of fstat</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I d=open(s,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// open file</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;Qs(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;d,s) &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return with error string if open failed</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">fstat(d,b)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// call fstat</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;s=(*n=b[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">])?ma(d,*n):s, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// allocate memory if size (b[6]) is &gt; 0, else</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// will return string with name (n will be zero)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;close(d), &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// close file</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;s; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return allocated memory (or string with name)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The function w2 writes a zero-terminated string to stdout, while r2 reads a maximum of 256 input characters from stdin (while also printing them to stdout) and returns the address of the zero-terminated string with these characters, stored in the static buffer b:</span></p><a id="t.b41fc28fefa8ecedd499b36d557eb9dd693cd4fe"></a><a id="t.30"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">V </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">w2(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{write(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">,s,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">strlen</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">(s));}<br>ZS </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">r2(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">{ZC b[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">256</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">];R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">w2(s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">,b[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">read(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,b,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">256</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">-1]=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,b;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><h2 id="h.tml3n1jpv5oq" style="padding-top:18pt;margin:0;color:#000000;padding-left:0;font-size:16pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:&quot;Arial&quot;;font-style:normal">Formatted strings</span></h2><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">All the format functions (named pi for integers, px for hexadecimal integers and pf for floating point values) use the static buffer b, with 24 bytes, to write characters from the end of the buffer:</span></p><a id="t.d19147c3bfee354ae4ada91f6683bfbfd18b279e"></a><a id="t.31"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZC b[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">24</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">];</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The static function ng, which precedes a string with a minus sign, is used for formatting negative values:</span></p><a id="t.4bcaf3a2baaa674c2738fb3f168810a6b1f86345"></a><a id="t.32"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ng(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R*--s=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'-'</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,s;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The pi function returns a string with a formatted integer in decimal base with the help of the static function pu, which prints an unsigned integer (in decimal base) from the least significant digit at the end of the buffer until the most significant one:</span></p><a id="t.e718f8253c6bd1456f8dce8bafe371a95d13b9bf"></a><a id="t.33"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pu(S s,J i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{J j;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">do</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*--s=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+i</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*(j=i/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);W(i=j);R s;}<br>S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pi(J i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;i?ng(pi(-i)):pu(b+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">23</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,i);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Integers can also be printed in hexadecimal base using px. This function calls hh(s,c), which writes the hexadecimal representation of the byte c to the string s. The symbol to use is selected on basis to the property that, in ASCII, ‘W’ is defined as ‘a’-10:</span></p><a id="t.1e21d014dc8539255795640478806e09d0601f40"></a><a id="t.34"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">hh(S s,C c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{N(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,C a=i?c&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">15</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:c&gt;&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;s[i]=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"0W"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;a]+a)R s;}<br>S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">px(J j)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{S s=b+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">23</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">unsigned</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">long</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;k=j;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">do</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">hh(s-=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,k)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;W(k&gt;&gt;=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);R s;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Floating point values are formatted with pf:</span></p><a id="t.4d4a9d7ba15010d47c9fcd0a2bbd6e563eac6ac8"></a><a id="t.35"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pf(F f)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;f,ng(pf(-f))) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// negative values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(!f,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"0.0"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">) &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// fixed format for zero value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// n is the exponent</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I n=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; W(f&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1e6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)--n,f*=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; W(f&gt;=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1e7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)++n,f/=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// print (integer) exponent if different of zero</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;S p=n?p=pi(n),*--p=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'e'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,p:b+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">23</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// only one non-decimal digit (n is the mantissa now)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;n=f+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">.5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;W(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">99</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;n&amp;&amp;!(n%</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))n/=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// move non-decimal digit to the left and add the dot</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R p=pu(p,n),p[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]=*p,*p--=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'.'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,p;<br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Parsing functions read values from the string passed as first argument with a maximum of n characters. The function ip reads integers and fp reads floating point values.</span></p><a id="t.aa9354101f5afae1d612481850c7557c5bfe045d"></a><a id="t.36"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">J </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ip(S p,I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'-'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*p,-ip(p+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,n</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))J j=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;N(n,j=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*j+p[i]-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)R j;}<br>ZF </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">x(I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{F e=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;N(n,e*=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)R e;} &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// n-th power of 10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>F </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">fp(S p,I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'-'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*p,-fp(p+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,n</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// negative values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I l=scn(p,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'e'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,n), </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// position of e, or last character if not found</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;m=scn(p,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'.'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,l), </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// position of dot, or l if not found</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;f=l&lt;n?ip(p+l+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,n-l</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">):</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// exponent (zero if e not found)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;j=ip(p,m), </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// non-decimal part</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;k;<br> &nbsp; &nbsp;m+=m&lt;l, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// increase m if there was a dot to point to decimal digits</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;k=ip(p+m,MN(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,l-=m)); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// decimal digits</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;k+=j*x(l), </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// integer number with all digits</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;f-=l; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// adjust exponent depending on number of decimal digits</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// make it a floating point value multiplying or dividing by</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the power of 10 determined by the exponent (f) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;f?k/x(-f):k*</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">x(f)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br>}<br></span></p></td></tr></tbody></table><h2 id="h.vq2zbsnq2l98" style="padding-top:18pt;margin:0;color:#000000;padding-left:0;font-size:16pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span>Arrays m</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:&quot;Arial&quot;;font-style:normal">emory management</span></h2><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Unique values are stored in K values, with the type in the first 2 bytes. Array values are stored in memory from a memory pool structured as a hash table, where the hash is related to the approximate array size. The address of the buckets is stored in the static array M. The total amount of assigned memory bytes (which is usually lower than the allocated one) is stored in the workspace variable W. I am not sure why the initial value is -32 (may it be because of the 32 bytes need for a fixed array?):</span></p><a id="t.1bd35d8eb3a1851497cddd4694ee2dbbccf86c6a"></a><a id="t.37"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZK M[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">31</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">];</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">ZJ W=-32;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The M[i] value points to a memory region with space available for 16&lt;&lt;i bytes. If more than one such region is available, the addressed memory will contain a pointer to it, in a linked list.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The function m1(n) returns a pointer from the memory pool with available space for n bytes. If there is a region available in a bucket, it is returned, and the bucket set to zero. If there is not, but there is memory in a larger bucket, it is returned from there and the remaining memory is assigned to a lower size bucket. If no memory is available, it is allocated with ma:</span></p><a id="t.b48388ea59e824f842112ee011900118561866b6"></a><a id="t.38"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZK </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">m1(J n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;K x,r;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// i is the bucket number (set only once)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I i=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">60</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-__builtin_clzl(n+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),j;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// If there is a memory region available, return it and</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set bucket address to the next one in the linked list</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(x=M[i],M[i]=xx,x)<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Search for a memory region in a bucket of larger size</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (in this case, M[j] will be != 0), or allocate the necessary</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// memory, with a minimum of 4 Mb (16L&lt;&lt;18)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 8 additional bytes are needed at the beginning for the attributes</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;j=i;W(!(x=++j&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">31</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?M[j]:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+ma(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;(j=MX(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">18</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i)))));<br> &nbsp; &nbsp;xm=i, &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set memory bucket attribute</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;M[j]=xx, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set bucket address to next region in linked list</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;r=x; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// r is the return value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Adjust larger buckets such that:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;W(i&lt;j) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// j-i are the memory regions that need to be assigned to buckets</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;x+=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;xm, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the next available memory region x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;M[*(J*)(x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)=i++]=x, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// is assigned to the corresponding bucket</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// with 8 preceding bytes for attributes</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;xx=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// and no more elements in linked list</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"><br> &nbsp; &nbsp;R r;<br>}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Arrays of type t and size n are allocated using the function tn(t,n). The size for each type is stored in the nt array:</span></p><a id="t.0539a8d78e6c3da25e277d06a9eed551b6241ac7"></a><a id="t.39"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// types are chijefs:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// pointer (list), char, hex byte?, int, long, e?, float, symbol (char as int)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>J nt[]={</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">};<br>K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">tn(I t,I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// allocate memory (minimum for 1 value) for every non-string type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K x=m1(MX(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,n)*nt[KS&lt;t?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:t]);<br> &nbsp; &nbsp;R<br> &nbsp; &nbsp; &nbsp; &nbsp;W+=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;xm, &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// add assigned memory to workspace</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;xu=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,xt=t,xn=n, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set metadata (not a function, type, length)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;x; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return memory address of first element</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">T</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">he static functions l1 and l0 respectively allocate and free fixed arrays for three pointer values and I think l2 should return an array of K strings with their values but has not been implemented yet. These fixed arrays have type 8 (there should probably be a #define KL 8L in a.h, but a comment indicates that these fixed arrays are an experiment). When a fixed array is freed with l0, its y and z elements are freed calling l0 recursively (I think the l0(xz) is unnecessary, it will be called from l0(xy)) and its memory is returned to the pool, making it the first element in the corresponding bucket and referencing the previous one as a linked list:</span></p><a id="t.94e8a8082694d85a471ec1aa839af418cc8611df"></a><a id="t.40"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZK1(l2){R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kp(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"[]"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;} </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// I think this is a TODO</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>ZV1(l0){</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">((J)xy)l0(xy),l0(xz);xx=M[xm],M[xm]=x;}<br>K3(l1){K r=m1(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">24</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);R rt=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,rn=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,rx=x,ry=y,rz=z,r;}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">More generally, arrays increase and decrease their reference counters with r1 and r0, respectively. If there is an overflow, r1 will abort (Is this expected? Why are there no similar checks anywhere else?). When r0 is called and there are no remaining references, it is returned to the pool:</span></p><a id="t.67dbac4a57cd2f6ac87dbb2ae4373623019fe248"></a><a id="t.41"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">K1(r1){<br> &nbsp; &nbsp;P(Ax,x) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// just return for unique values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R++xr?x:AB(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"r1"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// increase ref counter or abort on overflow</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br>V1(r0){<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(Ax||!x)R; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// just return for unique values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==xt){l0(x);R;} </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// call l0 for fixed array types</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(xr){--xr;R;} &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if there are remaining refs after decreasing, return</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(!xt||KS&lt;xt)N1(xn,r0(Xx)) &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// for arrays, call r0 for each value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;W-=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;xm, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// subtract from workspace</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;xx=M[xm],M[xm]=x; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return memory to pool</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">In practice, what happens is the following: the first time m1 is called, it will allocate enough space for n bytes, but in fact allocating a memory region whose size is a power of 2 multiplied by 16 bytes (with a minimum of 4 Mb). The not used memory is assigned to different buckets in the M variable, such that M[0] points to a 16 bytes memory region, M[1] points to a 32 bytes memory region, M[2] to a 64 bytes memory region, and so on. Next time m1 is called it will return an address from the smallest possible bucket. If the corresponding bucket does not contain a pointer (is zero), it will take the pointer from the next bucket, divide the region in two, and return one while assigning the other to M. Memory is never really deallocated, it is just returned to the pool. This is done storing pointers to regions of the same size in a linked list, such that a pointer is stored in the memory region pointed to by the address in M, and so on. Notice that, although a memory region can be divided in smaller ones, they are never merged back.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The additional function j2(x,y) is used to merge two arrays in one, copying the elements of y at the end of x or copying the elements of both in a new array if there is not available space or there is some reference to x. For this, it uses the static function xiy, which copies values from an array in another, assuming there is enough memory available:</span></p><a id="t.df678a301eabeb7139a00f7042f765793e22e788"></a><a id="t.42"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZK </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">xiy(K x,I i,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// copy contents of y after the i-th element of x (NX=size of x element)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">memcpy</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(x+NX*i,y,NX*yn);<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(!yt)N(yn,r1(Yx)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// increase references to elements in y (see below)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">Y0(x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// decrease reference to y and return x (this will also decrease</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the references to each of the elements of y, that is the reason</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// they need to be increased before)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br>K2(j2){<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// m is the old size, n is the new one</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I m=xn,n=m+(Ay?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:yn); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// increase 1 if y is a unique value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(!m&amp;&amp;!xt,X0(y)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// decrease ref to x and return y if x is empty</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if no available space or x is referenced, copy it to a new array</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;$(xr||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+NX*n&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;xm,x=xiy(tn(xt,n),</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x))xu=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,xn=n;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// copy contents of y to the end of x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;Ay?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">memcpy</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(x+NX*m,&amp;y,NX):xiy(x,m,y);<br> &nbsp; &nbsp;R x;<br>}<br></span></p></td></tr></tbody></table><h2 id="h.lr1vku26sow" style="padding-top:18pt;margin:0;color:#000000;padding-left:0;font-size:16pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:&quot;Arial&quot;;font-style:normal">REPL functions</span></h2><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The file a.c also includes several functions that can be used to build an interpreter. For this, it makes use of the ev() and ps() functions, defined elsewhere (ie. in the the b.c or k.c file):</span></p><a id="t.83f84e38a5c75474418c5fced5bbaf95f21f39cd"></a><a id="t.43"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ev()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ps()</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">There is space available for 26 global variables (including functions), stored in the G array. Each of them will be named by a single letter from a to z. There is also a K0 value which is not used by b.c, although it is initialized (in the km function, see below):</span></p><a id="t.5c1dc3a9e73aac4335ed7eb9609a262fdd3b674f"></a><a id="t.44"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">K G[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">]; ZK K0;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The interpreter program will start with the _start function, avoiding the fatter (!) main function. This function first writes a 32 bit integer before the stack pointer (at address -4(%rsp)) &nbsp;and calls ldmxcsr to set the 32 bit register MXCSR, which contains flags for control and status information regarding SSE instructions. Then, it moves the pointer at 8(%rsp), which corresponds to argv, to %rdi (first function argument) and jump to km.</span></p><a id="t.88d3e82305780a63080b205da78a536bfcaa2645"></a><a id="t.45"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">V _start(){</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">&nbsp; &nbsp; asm</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"movl $0x9fc0,-4(%rsp);ldmxcsr -4(%rsp);lea 8(%rsp),%rdi;jmp km"</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The flags of the MXCSR register are the following:</span></p><p style="padding-top:0pt;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">FZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flush To Zero<br>RN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits 13 and 14 are 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Round To Nearest<br>PM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Precision Mask<br>UM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Underflow Mask<br>OM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Overflow Mask<br>ZM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Divide By Zero Mask<br>DM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Denormal Mask<br>IM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Invalid Operation Mask<br>DAZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bit 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Denormals Are Zero</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The flags FZ (also called FTZ) and DAZ make possible to code unique values of other types as a special case of floating point values, since they imply, in practice, that a number with a zero exponential part is not a valid floating point number.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Inside km, G values are initialized to be new values (NL), and K0 to be a zero length char array (this value is never used later). Then, the first argument of the program (a is argv[0], so ++a is argv[1]), if given, is loaded with the ld function. Finally, the program enters in an infinite loop reading user input with r2, evaluating the obtained string with es and printing the result with pr:</span></p><a id="t.c1e96b546dc5744c536e311f88f41859cd7eeae2"></a><a id="t.46"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">V </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">km(S*a)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;N(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,G[i]=NL)*(K*)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// init globals to empty values</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(K0=kK(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))=c0(); &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// init K0 to empty char array</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(*++a)pr(ld(*a)); &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// load file in first argument</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;W(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)pr(es(r2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">" "</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)));</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// REPL</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The loading function ld reads a file line by line, processing its input with pr and es:</span></p><a id="t.c89155169d71e656944e305c2ad61b01a295a373"></a><a id="t.47"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS1(ld){<br> &nbsp; &nbsp;J n; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// file size</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;Q(s=mf(s,&amp;n)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// mmap file or return file name as error string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;S t=s,u; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// t=first char in line, u=first char in next line</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I a,d=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse until EOF or an exit command is found</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;W(t&lt;s+n&amp;&amp;d&gt;=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// finish line with a null character and set u to the first character</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// of next line. a will be 1 for a single / character (may be a comment)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// and -1 for a single \ character (exit command)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;u=sc(t,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),*u++=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,a=t[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:(*t==</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'/'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)-(*t==</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'\\'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if not a comment (starts with //) and not exiting, evaluate string</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// and print</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">result, possibly returning an error string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(!d&amp;&amp;!a&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'/'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-*t)Q(pr(es(t)))<br> &nbsp; &nbsp; &nbsp; &nbsp;d+=a,t=u; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// next line</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(n)munmap(s,n); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// unmmap non-zero file (zero files are not mmapped)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R NL; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return empty value</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"><br>}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Strings (zero-terminated) are evaluated, both inside ld and the infinite loop in km, by es. This function will call different functions for system commands (\\ or \ to exit, \w to return workspace size, \v for global variables, \f for functions, \t to time a command and \l to load a file) or ev (defined in b.c or k.c) for everything else:</span></p><a id="t.ef67cf9183f37a9e10bf9fb70b36fad54cc580ea"></a><a id="t.48"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS1(es){<br> &nbsp; &nbsp;K x;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return empty value from empty line, else evaluate with ev</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// everything that is not a system command (does not start by \).</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// If there is a parsing error, ps will return an error string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// and will be returned, else it will return NL, I think</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'\\'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-*s,!*s?NL:(x=ps(s))&amp;&amp;NL-x?X0(ev(x)):x)<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// exit with \ or \\ command</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(!*++s||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'\\'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">exit</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);<br> &nbsp; &nbsp;R !s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]? </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// single system commands with no arguments</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'w'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s?ki(W): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return workspace size as an integer K value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;sc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"vf"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,*s)?vf(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'f'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// run vf function for \v or \f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;qs(s) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return error string with command</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// system commands with arguments</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'t'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s?tm(s+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">): &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// time command just in next character</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'l'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s?ld(s+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">): &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// load file (after a space)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;qs(s); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return error string for everything else</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The commands \v and \f call the vf function (with argument 1 for functions and zero otherwise). It returns an array with the numbers of the variables used with type string (char*). This will be understood by the pr function to format it as a list of variables with single letter names:</span></p><a id="t.eac3916d4f220980f7060f9356d7a9d6fb8a3da7"></a><a id="t.49"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZK </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">vf(I f)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;K r=kS(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// strings array for output, initially empty</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;N(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 26 is the number of global variables</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;K x=G[i];<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(NL-x) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// skip empty values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(f^(Ax||xt)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// functions do not have a type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;r=j2(r,ks(i)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// append variable number with string type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;)<br> &nbsp; &nbsp;R r;<br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Command \t times the following command calling tm. If it is called as \t:n, the function is repeated n times. The static function ms, called from tm, returns the time from the last reset of the tsc counter in milliseconds, assuming that each cpu cycle lasts 0.58e-6 ms. The number of cycles is got calling the asm instruction rdtsc, which stores the 64 bits number in two 32 bits one (in this case, a and d): </span></p><a id="t.44fc73e0e445557066f7f32c8f7ee5b085f61d46"></a><a id="t.50"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZF </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ms()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;J a,d;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">asm</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">volatile(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"rdtsc"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"=a"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">(a)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,"=d</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"(d));<br> &nbsp; &nbsp;R((d&lt;&lt;32)+a)*.58e-6;<br>}</span></p></td></tr></tbody></table><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal"></span></p><a id="t.a1507f20a1c05b1e65d6a7f67e3e07f115a596ec"></a><a id="t.51"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZS1(tm){<br> &nbsp; &nbsp;S t=sc(s,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">' '</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// find space</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;Qs(!t,s) &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return error if space not found</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;*t=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// replace space with null character</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// n is the number of times the command to time is run</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I n=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-*s++?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// only once if : not used</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;*s-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?ip(s,t-s): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse integer number</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;(J)es(s); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// evaluate an expression</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse string if system command and assign result to x (zero otherwise)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K x=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'\\'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-*++t?ps(t):</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,r;<br> &nbsp; &nbsp;F a=ms(); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// get initial "time"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// run command n times, ending returning an error if it happens.</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// It is assumed that every system command is \l, but it is not checked.</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// The returned value ref counter is decreased at the end of each iteration</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;N(n,Q(r=x?ev(x):ld(t+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))r0(r))<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(x)r0(x); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// decrease ref counter again (just in case, I think)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ki(ms()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-a); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return time difference</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The result of es when loading files or in the REPL is printed by pr, which does not do much more than calling the output function o, which will call, for non-errors, the more complex se function:</span></p><a id="t.3baee16c79cd48c4da8378fa6ca17fc8d75aa92e"></a><a id="t.52"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZK1(pr){</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(NL-x)r0(o(x));R x;} </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// print non-empty values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>K1(o){<br> &nbsp; &nbsp;K y=QQ-Ax?se(x): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if not an error, store string representation of x in y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// else, y is "ERROR:" and the returned string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (removing the error type from first 16 bytes of the pointer) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;j2(kp(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"ERROR: "</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),kp((S)(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1U</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">L&gt;&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;(J)x)));<br> &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">Y0(write(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,y,yn)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">nl()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// print it to stderr</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br>ZK1(se){<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// function c returns a quoted string, or its characters in hexadecimal</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">// if it contains non-printable characters (which means it is a function),</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; // formatted as TxX, where T is the type number of the return value and X</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">&nbsp; &nbsp; // is its address in hexadecimal</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (why is this function inside se instead of being a static one?)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K1(c){<br> &nbsp; &nbsp; &nbsp; &nbsp;N(xn,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">94u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;Xc</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">){ </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// non-printable characters (not from 32 to 126)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;K r=kC(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*xn); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// each char requires 2 hex digits</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;N(xn,hh(r+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*i,Xc)) &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// fill r with x representations</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R j2(c2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+xu,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'x'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),r); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// format</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cj(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'"'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,jc(r1(x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,'"')); &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return quoted string (or list)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// increasing the ref counter of x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;P(Ax, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Unique values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;KS==Ax?c2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'`'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+xi): &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// KS unique chars preceded by a back quote</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;KC==Ax?X0(c(x=c1(xi))): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// quoted single char</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;kp( &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// string as K value for</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;KI==Ax?pi(xi): &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// integer values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;KF==Ax?pf(xf): &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// floating point values</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(S)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"+"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+!xi &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// operators</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp;)<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// from here, x is an array</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==xt,l2(x)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return "[]" for fixed array (a TODO, I suppose)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==xn,cj(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">','</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,se(Li(x,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)))) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// preceed single value arrays by a comma</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I t=KS&lt;xt?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:xt; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// t is the type of x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(KC==t,c(x)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// an array of chars is returned as a quoted string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(!xn,c2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"!("</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[!t],</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">") &nbsp;0 &nbsp; `"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[t])) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// empty values: "()" for list, "!0" for</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// integers, "!`" for KS values, and "! "</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// for everything else</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;x=sS(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"; &nbsp; &nbsp; &nbsp;"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[t],e1(se,x)); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// separate elements formatted as strings with</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// semicolons for lists, with spaces otherwise</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R!t?cj(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,jc(x,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">')'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)):x; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// enclose lists in parens</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"><br>}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">These additional functions are called from se:</span></p><a id="t.e56dd67ba726bd31b393ed3e801663460ac58f0b"></a><a id="t.53"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Return item in position i as unique element</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>ZK </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">Li(K x,I i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R<br> &nbsp; &nbsp;!xt||KS&lt;xt?Xx: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// list element</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;KC==xt?kc(Xc): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// char</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;KI==xt?ki(Xi): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// integer</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;ks(Xi); &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// string</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>}<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Evaluate f for every element of x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>ZK </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">e1(K(*f)()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,K x){<br> &nbsp; &nbsp;K r=kK(xn); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// result array, of same length as x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;N1(rn,Rx=f?f(Li(x,i)):Li(x,i)) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// e1 is only called with an f, so this check</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (to just return the array elements if f is</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// null) should not be necessary</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R r;<br>}<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Return string with elements of x separated by c</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br>K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">sS(I c,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;I n=c?xn:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// will double size with separators</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;N(xn,K y=Xx;n+=yn) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// add length of each element</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K r=kC(n); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// make array of total length needed</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(c)--rn; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// ignore the last separator</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (although it is added and memory for it is allocated)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// form return string r (s is the current position in the N loop)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;S s=r;<br> &nbsp; &nbsp;N(xn,K y=Xx;s=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">memcpy</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(s,y,yn)+yn;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(c)*s++=c)<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return string decreasing the ref counter of x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">X0(r)</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;<br>}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Finally, there is an enm function, which creates an array of integers from 0 to xi:</span></p><a id="t.a92bd3256c591daadd97da088480429e92d9ebbb"></a><a id="t.54"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">K1(enm){K r=kI(xi);N(rn,Ri=i)R r;}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The a.c file also includes a rand static function to generate (semi)random numbers, but it is not used (maybe a missing \r system command? It may be easily implemented multiplying by the the result of ms and dividing to have a float between 0 and 1). The digits of pi are used as seed, together with the value 4294957665 (recommended in numerical recipes):</span></p><a id="t.62d9603c86ee5cd053e92f977d28630a0cfe28eb"></a><a id="t.55"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">ZI </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">rand()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{ZJ j0=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-314159</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;R j0=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4294957665L</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*j0+(j0&gt;&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">32</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">);}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><h1 id="h.1ipscxo1xnk7" style="padding-top:20pt;margin:0;color:#000000;padding-left:0;font-size:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;font-family:&quot;Arial&quot;;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:&quot;Arial&quot;;font-style:normal">b.c</span></h1><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">That was the easy part. Now it gets complicated.</span></p><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The b interpreter (I assume the k one is not too different) works generating strings with machine code and executing them casting to a function. It is basically a compiler. Of course, no constants are used, just opcodes in hexadecimal. There are also no comments, except for this gem:</span></p><a id="t.8ce4eed3a2cf4466b98a942210df426fd8e1f371"></a><a id="t.56"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">// :+-*% ^&amp;|&lt;=&gt; &nbsp;x64 JJ Jj o2 cc tst RET cll psh pop acdbsbsd89.. &nbsp;o[m[s|d]] c3 eb+1 e8+4 e9+4 [f2/66/4*][0f] 5* 7*+1 b*+4 0f8*+4 &nbsp;03 23 2b 3b (6b 83) 89 8b ..</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">This means:</span></p><ul class="lst-kix_np04nh9dmrtq-0 start" style="padding:0;margin:0"><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">:+-*% ^&amp;|&lt;=&gt; dyadic functions</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">JJ Jj o2 cc tst RET cll psh pop: x64 specific functions</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">acdbsbsd89…: registers ordered by address (rax is 0, rcx 1, rdx 2, …)</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">o[m[s|d]]</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span>c</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">3: return</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span>e</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">b+1: JMP rel8</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span>e</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">8+4: CALL rel32</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span>e</span><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">9+4: JMP rel32</span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">...</span></li></ul><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">Some useful references:</span></p><ul class="lst-kix_tksont54az5u-0 start" style="padding:0;margin:0"><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline"><a href="https://www.google.com/url?q=https://www.google.com/url?q%3Dhttp://www.c-jump.com/CIS77/CPU/x86/lecture.html%26amp;sa%3DD%26amp;ust%3D1602556328270000%26amp;usg%3DAOvVaw0oZE1xE49D1RbJ6nsQVHLT&amp;sa=D&amp;ust=1602556328391000&amp;usg=AFQjCNFTmUBAbmr4_PgTQPISxcpLURHieg" style="color:inherit;text-decoration:inherit">http://www.c-jump.com/CIS77/CPU/x86/lecture.html</a></span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline"><a href="https://www.google.com/url?q=https://www.google.com/url?q%3Dhttp://ref.x86asm.net/coder64.html%26amp;sa%3DD%26amp;ust%3D1602556328271000%26amp;usg%3DAOvVaw0iJY_BVWBL3SMWx_tCG4mg&amp;sa=D&amp;ust=1602556328391000&amp;usg=AFQjCNE3iWKNIB5NJhaMfdHt4v8BgrVYHw" style="color:inherit;text-decoration:inherit">http://ref.x86asm.net/coder64.html</a></span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline"><a href="https://www.google.com/url?q=https://www.google.com/url?q%3Dhttps://en.wikipedia.org/wiki/X86_calling_conventions%26amp;sa%3DD%26amp;ust%3D1602556328271000%26amp;usg%3DAOvVaw2c_nd2R1Upa36bShE__6s2&amp;sa=D&amp;ust=1602556328391000&amp;usg=AFQjCNE4Chs8ykvJggyjXCCU3757ykKToA" style="color:inherit;text-decoration:inherit">https://en.wikipedia.org/wiki/X86_calling_conventions</a></span></li><li style="padding-top:0pt;color:#000000;padding-left:0pt;font-size:10pt;padding-bottom:10pt;line-height:1.15;margin-right:0;margin-left:36pt;font-family:&quot;Arial&quot;;margin-top:0;orphans:2;margin-bottom:0;widows:2;text-align:left;padding-right:0"><span style="text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline"><a href="https://www.google.com/url?q=https://www.google.com/url?q%3Dhttps://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf%26amp;sa%3DD%26amp;ust%3D1602556328271000%26amp;usg%3DAOvVaw3zRZ014v1LGoQkrGKzykDi&amp;sa=D&amp;ust=1602556328391000&amp;usg=AFQjCNGuZqBMvOEIKLV4VsG0K3MgNP890g" style="color:inherit;text-decoration:inherit">https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf</a></span></li></ul><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">There are two functions: ps parse a string to generate an array of K values that ev executes, casting to a function, the type number in yu indicates the resulting type of the function (a generic K value, a float value or an integer):</span></p><a id="t.a226b4e747b381ebb0a4ae36ab00be8824921783"></a><a id="t.57"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// Evaluate a function, the x argument must be a K* array,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// where the second argument is the function (a character string)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// and the return type is its u attribute</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"><br>K1(ev){<br> &nbsp; &nbsp;x=xy,<br> &nbsp; &nbsp;x=<br> &nbsp; &nbsp; &nbsp; &nbsp;KS&lt;xu?((K(*)())x)():<br> &nbsp; &nbsp; &nbsp; &nbsp;KF==xu?kf(((F(*)())x)()):<br> &nbsp; &nbsp; &nbsp; &nbsp;ki(((J(*)())x)());<br> &nbsp; &nbsp;R x;<br>}</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;height:10pt;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal"></span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;font-family:&quot;Arial&quot;;line-height:1.15;orphans:2;widows:2;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal">The ps function is where all the fun is. It includes several embedded functions:</span></p><a id="t.df940dddeb61ab43605ed6ee731823c86b8ce85c"></a><a id="t.58"></a><table style="border-spacing:0;border-collapse:collapse;margin-right:auto"><tbody><tr style="height:0pt"><td colspan="1" rowspan="1" style="border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#ffffff;border-left-style:solid;border-bottom-width:0pt;width:451.4pt;border-top-color:#000000;border-bottom-style:solid"><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ps(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp;K z;<br> &nbsp; &nbsp;I a=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,<br> &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// addresses of registers in function calling convention order</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;A[]={</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">11</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">12</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">13</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">14</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">15</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">},<br> &nbsp; &nbsp; &nbsp;B=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,<br> &nbsp; &nbsp; &nbsp;RET=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xc3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return opcode</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// jumps and conditional jumps</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp;jmp &nbsp;jb &nbsp; jz &nbsp; jnbe jmp32 jnb &nbsp;jnz &nbsp;jbe &nbsp; jnb32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp;JJ[]={</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xeb</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x72</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x74</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x77</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xe9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x73</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x75</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x76</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0f83</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">};<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">// convert octal number abc to integer,</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">&nbsp; &nbsp; // used to fill mod(2),reg(3),r/m(3) byte</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">m(I a,I b,I c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">64</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*a+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;b)+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;c);}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if required, adds additional opcode for access to new 8 bit registers</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">rex(I r,I x,I b,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// rex instructions:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp;0x41=rex.b, &nbsp;0x42=rex.x, &nbsp;0x43=rex.xb, 0x44=rex.r,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp;0x45=rex.rb, 0x46=rex.rx, 0x47=rex.rxb</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;R(r=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;A[r])+(x=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;A[x])+(b=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;A[b])?cj(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x40</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*r+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*x+b,y):y;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// opcode o, arguments x,y (not rex: x should never be &gt;15)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">h(I o,I x,I y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">256</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&gt;o?c1(o)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 1 byte opcode</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c2(o&gt;&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,o)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 2 byte opcode</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 3 bit for mod, 3 bit for reg, 3 bit for r/m</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// mod 3 =&gt; register addressing mode:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; first arg (x) in reg</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; second arg (y) in r/m</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16&gt;y?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c1(m(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// mod 0 and r/m 5 =&gt; displacement only addressing mode:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; first arg (x) in reg</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; second arg (y) in 32 bit address following the instruction</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c5(m(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y)<br> &nbsp; &nbsp; &nbsp; &nbsp;);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// opcode o, arguments x,y (maybe rex)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">i(I o,I x,I y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">rex(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&gt;x?x:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&gt;y?y:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;h(o,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&gt;x?A[x]:x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&gt;y?A[y]:y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// function call</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cll(I c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c5(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xe8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// push from register A[x]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">psh(I t,I x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">rex(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,c1(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x50</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&amp;A[x])</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">));}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// pop to register A[x]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">pop(I t,I x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">rex(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,c1(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x58</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&amp;A[x])</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">));}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// condition (set byte on conditon functions: 0x0f90,...)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cc(I o,I x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(i(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0f20</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">+JJ[o],</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">i(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0fb6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// test (sets sz if x is not zero), abort for fp x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">tst(I t,I x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R KF==t?AB(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"tst"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">):i(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x85</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x,x);}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">Jj(K x,I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cj(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,c5(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">+x[xn],n</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return object code to execute opcode o with arguments x and y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// and leave the argument, of type t, in register r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">o2(I t,I o,I r,I x,I y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;K z;<br> &nbsp; &nbsp; &nbsp; &nbsp;P(KF==t,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?AB(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"vex"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">):j2(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 0xc5 is an invalid instruction, next char is ???</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xc5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;~r)+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">15</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;~x)+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// for fp (with 0f prefix): i2f is integer to float</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; &nbsp;mov &nbsp;add &nbsp;sub &nbsp;mul &nbsp;div &nbsp;cmp &nbsp; &nbsp; &nbsp;i2f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;h((C[]){</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x10</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x58</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x5c</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x59</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x5e</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x2e</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x2a</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">}[o],r,y)<br> &nbsp; &nbsp; &nbsp; &nbsp;))<br> &nbsp; &nbsp; &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">f(I o,I x,I y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// for ints: &nbsp; &nbsp;mov &nbsp;add &nbsp;sub &nbsp;imul &nbsp; &nbsp; cmp &nbsp;and</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">127</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;y?i((I[]){</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x8b</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x03</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x2b</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0faf</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x3b</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x23</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">}[o],x,y):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rex(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// reg indicates the operation: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">05741=add,sub,cmp,and,or</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;o?c3(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x83</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,m(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">" \0\5\7\4\1"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[o],A[x]),y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c5(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xb8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;A[x]),y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// move to register x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;I a=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">126</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;y,s;<br> &nbsp; &nbsp; &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;=o&amp;&amp;r==x&amp;&amp;(!a||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o),<br></span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">// 4 is %, which forces arguments to be floats, when used with</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // integers, it means shift right (/)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o?f(o,r,y):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">129</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-y?AB(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"/"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// shift only by one, or abort</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//shift one to the right</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xd1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,r)<br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&lt;o&amp;&amp;r==y,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z=f(o,r,x),</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neg</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o?z:j2(z,i(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xf7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,r))<br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp;P((a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)&lt;o,j2(f(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,r,x),f(o,r,y)))<br> &nbsp; &nbsp; &nbsp; &nbsp;R<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;s=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;o?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+(o+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rex(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R,a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">:y,x,</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // &nbsp; &nbsp; &nbsp; &nbsp; mov &nbsp;mov &nbsp; &nbsp; &nbsp;lea &nbsp;imul</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c3(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;o?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;o?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x8b</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x89</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x8d</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x6b</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">m(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o?a:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,A[r],a?A[x]:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a?(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-o?y</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-y)&lt;&lt;s:m(s,A[y],A[x])<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// compare</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cm(I t,I x,I y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">o2(t,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,x,y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// convert to float</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cv(I x,I y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">o2(KF,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,x,x,A[y])</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">sh(I t,I r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">AB(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"sh"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// length of instruction</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ln(S s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;I o=*s++, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// opcode</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;h=o/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// first hex digit of opcode</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// add 2 for invalid opcode, 1 for 2 byte opcodes</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xc5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==o?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==o;<br> &nbsp; &nbsp; &nbsp; &nbsp;R<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==h?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+ln(s): &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// h=4 =&gt; rex</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RET==o||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==h?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// h=5 =&gt; push/pop</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*JJ==o||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==h?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// h=7 =&gt; conditional jumps</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xe</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==h||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xb</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==h?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// h=0xe =&gt; call, h=0xb =&gt; mov</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: &nbsp; &nbsp;</span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">// conditional jumps</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 3==s[p]/64 =&gt; mod == 11 =&gt; r/m is a register</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add &nbsp; &nbsp; &nbsp;imul</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==s[p]/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">64</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x83</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==o||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x6b</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==o):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;color:#880000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">// 5==(0xc7&amp;s[p]) =&gt; displacement addressing mode</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (mod=00, r/m=101)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// with displacement addressing mode the instruction</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// will have one instruction byte, one for mod,reg,r/m</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// and four for the address, else instruction, mod,reg,r/m</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// and one byte for the register</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xc7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;s[p])?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// linker: fix relative addresses</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;V1(lnk){<br> &nbsp; &nbsp; &nbsp; &nbsp;S s=x;<br> &nbsp; &nbsp; &nbsp; &nbsp;W(s&lt;x+xn){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 4==*s/16 =&gt; *s is a REX instruction, skip it</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I n=ln(s+=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xc5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0x0f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S r=s+n</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-4</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // check if instruction uses relative address argument:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">(</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xe8</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">==*s|| //function call</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(p?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;*s/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s/</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">5</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xc7</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">+p])</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*(I*)r=(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0xe8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s?a-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*r?x:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*r?(S)l1:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ((K*)G[*r])[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;*r?(S)&amp;zF[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+*r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(S)(G+*r-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)-r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;s+=n;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// disassemble (only used for debugging, commented)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;V1(dis){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// print output type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;w2(px(xu)),oc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);<br> &nbsp; &nbsp; &nbsp; &nbsp;S s=x;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// print code</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;W(s&lt;x+xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">){N(ln(s),w2(px(*s++)))oc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">' '</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// print D[0] and D[1]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;N(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,w2(px(*s++)))<br> &nbsp; &nbsp; &nbsp; &nbsp;nl();<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// assign return type to function value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(I u,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R xu=u,x;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// jump</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">jmp(I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;R n&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">||n&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">127</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c5(JJ[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">],</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;n?n</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:n): </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// long jump</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c2(*JJ,n); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// short jump</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">O2(I t,I f,I r,K x,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;I i=Ay?yi:yu; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// y can be a value or a function</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(r,j3(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Ay?c0()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:y,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// function</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10&gt;f?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">o2(t,f,r,xu,i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// comparison</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j2(cm(t,xu,i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,16&gt;r?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">cc(f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c1(f</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)<br> &nbsp; &nbsp; &nbsp; &nbsp;));<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">SH(I t,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(yu,j2(y,sh(t,yu)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">));}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set r, of type t, to zero (2 is sub, and r-r=0)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">ZR(I t,C r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(r,o2(t,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,r,r,r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// move value y with type t to register r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (func 0 is mov, the first argument is an empty array)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">MV(I t,I r,K y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">O2(t,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,r,u(r,c0()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),y);}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse numbers, returning either an integer or a fp value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// NB: float values as 1e6 are not allowed, they must contain a dot</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">Na()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;S r=s;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set s to end of number (exponential form not considered)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;W(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">10u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;*++s-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'.'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s);<br> &nbsp; &nbsp; &nbsp; &nbsp;I f=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// check if it is floating point</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;N(s-r,f|=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'.'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==r[i])<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the two loops may actually be merged in one:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// W(10u&gt;*++s-'0'||f|='.'==*s);</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return float or int</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;R f?kf(fp(r,s-r)):ki(ip(r,s-r));<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// N is the counter variable (initially i, then j,k,l,...)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// D[0] are local vars (and arguments), D[1] local floats</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// L is the D value for that variable</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// T is the type of local variables</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;C N=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,D[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]={</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">},L[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">],T[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">];<br> &nbsp; &nbsp;N(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,L[i]=T[i]=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set r to arguments list for function definitions</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;S r=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'['</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]&amp;&amp;(r=sc(s,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">']'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))&amp;&amp;*++r?r:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;I M=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// registers in use</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set a to global name for assignments and function</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// definitions and point k to its address</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K*k=r||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]?a=*s,s+=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,G+a-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// fill with array using enm</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// NB: !2+2 or !(2+2) is not !4; just ints, not expressions</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'!'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s,++s,X(k,enm(ki(ip(s,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">strlen</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(s))))))<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return the type of a value</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I1(t){<br> &nbsp; &nbsp; &nbsp; &nbsp;I a=xi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;R !Ax?xu: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//function (return type)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">126</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;xi?KI: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//integer (coded in single byte)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;a&amp;&amp;T[a]?T[a]: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//variable</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;A(x=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;a?G[a]:zK[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+xi</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">])?Ax: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//variable or argument as an</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// additional element of z</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xt+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//array (element type + 4th bit)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;I1(q){<br> &nbsp; &nbsp; &nbsp; &nbsp;I i=xi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;R Ax?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;i&amp;&amp;L[i]?L[i]:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// why not ':'-*x like everywhere else?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*x?I(xy):</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">auto</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">d()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// expression x to register r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">e(I r,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;K y=d(r,x);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// just pass y for arrays and functions. Else</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if y is zero, either coded as a small int (128),</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// or in the z array, set register to zero (ZR),</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// else move value to register</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;R Ay?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==yi||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;yi&amp;&amp;!zK[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+yi</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]?ZR(t(x),r):MV(t(x),r,y):y;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">b(I f,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;K y=d(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x);<br> &nbsp; &nbsp; &nbsp; &nbsp;R Ay?AB(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"b"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==yu?y[yn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]=JJ[y[yn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]+f*</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">],y:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;j3(y,tst(t(x),yu),c1(JJ[f?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">6</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]));<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// transform values and other expressions into object code,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// except conditional expressions, and leave result in register r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">f(I r,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;K y=e(r,x);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if not a function, move value y to register r</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;R r-yu?MV(t(x),r,y):y;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">E(I r,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;I i=xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;K z=e(r,Xx),y=kK(i--);<br> &nbsp; &nbsp; &nbsp; &nbsp;r=zu,Yx=z;<br> &nbsp; &nbsp; &nbsp; &nbsp;W(i--)Yx=e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,xK[i+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]);<br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(r,sS(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// transform conditional expressions $[] into object code</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">v(I r,K x,I n)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;K y=xz,z;<br> &nbsp; &nbsp; &nbsp; &nbsp;I c=!n&amp;&amp;!Ay&amp;&amp;a==*y,l=M;<br> &nbsp; &nbsp; &nbsp; &nbsp;K1(h){R++s,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;n?e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x):f(r,x);}<br> &nbsp; &nbsp; &nbsp; &nbsp;z=h(xK[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]),M=l,y=h(y),x=b(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,xy);<br> &nbsp; &nbsp; &nbsp; &nbsp;y=j2(y,n||c?yn-=c*B,jmp(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-n?n-xn-yn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:zn):c1(RET));<br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j3(jc(x,yn)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y,z);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// loop (W or N)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K1(w){<br> &nbsp; &nbsp; &nbsp; &nbsp;I i=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'N'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*x?L[N++]:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,j=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;V </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">mm(K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I i;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(Ax,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;xi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;&amp;L[i=xi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">])M|=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;L[i]<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)$(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*x&amp;&amp;A(xy),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i=I(xy)-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,M&amp;=~(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;L[i]),mm(xz)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)N(xn,mm(sc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"{WNC"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,*x)?xK[xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-i]:Xx))<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;mm(x);<br> &nbsp; &nbsp; &nbsp; &nbsp;K y=xy,z=xz;<br> &nbsp; &nbsp; &nbsp; &nbsp;P(!i&amp;&amp;!Az&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'$'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*z,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x=b(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z=v(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,z,-xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;j3(jc(x,zn+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),z,jmp(-xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-zn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))<br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp;x=i?M|=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;i,<br> &nbsp; &nbsp; &nbsp; &nbsp;jc(cm(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i,j=(j=q(y))?j:*D),JJ[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]):b(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y),<br> &nbsp; &nbsp; &nbsp; &nbsp;z=i?j2(e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,z),o2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i,i,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">129</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)):e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,z);<br> &nbsp; &nbsp; &nbsp; &nbsp;I n=-zn-xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;z=j3(jmp(zn),z,n&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?--xn,j2(x,Jj(x,n)):jc(x,n));<br> &nbsp; &nbsp; &nbsp; &nbsp;R i?--N,M&amp;=~(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;i),j3(f(j,y),ZR(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i),z):z;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">g(I c,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;K y=c0(),z,r=c0();<br> &nbsp; &nbsp; &nbsp; &nbsp;I i=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,l=a?M:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;W(++i&lt;xn){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z=Xx;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I l=M&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;i,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;b=Az||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;*z&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-*z||i-L[I(zy)-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;h=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-i||Az||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;c;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z=f(i,z);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(!h)z=j3(psh(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),z,pop(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(l)z=j2(b?psh(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i):z,b?z:psh(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i)),r=j2(r,pop(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y=j2(z,y);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;z=cll(c);<br> &nbsp; &nbsp; &nbsp; &nbsp;W(i&lt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">){</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(l&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;i)z=j3(psh(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i),z,pop(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,i));++i;}<br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">j3(y,z,r)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// lookup c character in s and return index, or zero if not found</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">l(S s,I c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{S t=sc(s,c);R t?t-s:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return kind of character c</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// NB: broken to fit into several lines, it was a single</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; 128&gt;c with a very long string in the original</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// !"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">c(I c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">65</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;c?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">" &nbsp; +$++ ()++ + +0000000000+;+++ &nbsp;"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[c</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">97</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;c?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"aaaaaaaaaaaaaNaaaaaaaaWaaa[+] &nbsp;`"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[c</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//abcdefghijklmnopqrstuvwxyz{|}~</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;c?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">"aaaaaaaaaaaaaaaaaaaaaaaaaa{+} "</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[c</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-32</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// function number corresponding to character i</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;I </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">U(I i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">l(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">" +-*% &amp;| &nbsp;&lt;=&gt;"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,i)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// to register, constant or global</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">d(I r,K x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;P(Ax,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(r=q(x))?M|=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&lt;&lt;r,u(r,c0()):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x<br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp;I1(h){</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">I t=T[xi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">];</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">14</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==t?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">13</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==t?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*t</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-26</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">;</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">}<br> &nbsp; &nbsp; &nbsp; &nbsp;I s=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">15</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&amp;r,a;<br> &nbsp; &nbsp; &nbsp; &nbsp;K y,z;<br> &nbsp; &nbsp; &nbsp; &nbsp;S((y=xy,c(a=*x)), // a is the function, y the first argument<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">case</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">'N':<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'W'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R w(x))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'$'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R u(r,v(r,x,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'{'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R E(r,x))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'['</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R g(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R T[a-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]?O2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+h(xx),s,d(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,xx),d(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y)):g(a-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R y=d(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y),O2(t(x),U(a</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),yu,y,d(s,xz))),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// default</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P(Ay,r=L[yi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">],M&amp;=~(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;r),f(r,xz))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y=d(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,yy),z=e(s,xz),x=xy;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R r=zu,u(r,j2(z,O2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,h(xx),r,d(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,xx),y)));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I m,b=t(y);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">3</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&gt;xn, // monadic functions</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // this will eventually abort (sh not implemented)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'&amp;'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?SH(b,e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y)):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// conversion to float</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'%'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?y=e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">,y),u(s,j2(y,cv(s,yu))):</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // shift left, implemented as an addition</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // (a shift left is a multiplication by 2, which is the</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // same as adding it to itself)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'\\'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?y=e(s,y),O2(b,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,s,u(yu,c0()),y):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'#'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-3</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: &nbsp; &nbsp; // number of elements<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'*'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+h(y): // derefer</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">ence pointer</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'/'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: &nbsp; &nbsp; &nbsp;// </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">shift right</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;(</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">4 is division for fp,</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // but it means shr applied to ints</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; U(a), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">dyadic</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp;function<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s,</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">e(s,y), // first argument is y</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// second argument is one (kc(129)) or</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// kc(127) for # (why?) or zero for * (why?)</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">kc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'#'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'*'</span><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">!=a))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z=xz; // z is the second argument</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // a is func number, r will be zero for</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Consolas&quot;;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // the first literal long argument if the</span></p><p style="padding:0;margin:0;color:#000000;font-size:10pt;font-family:&quot;Arial&quot;;line-height:1.15;text-align:left"><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;font-weight:400">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // op is not a comparison</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;a=U(a),r=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;a||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">16</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-r?r:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P(!Ay&amp;&amp;!q(y)&amp;&amp;!Az&amp;&amp;!q(y), </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// bug? Last one: q(z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;M|=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;(m=D[KF==b]++),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;y=e(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,y),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;M&amp;=~(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;&lt;m),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z=O2(b,a,r,y,f(m,z)),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--D[KF==b],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R Ay&amp;&amp;!q(y)&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-a&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">4</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-a?O2(b,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;a?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">11</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-a+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">11</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">:a,r,e(s,z),y):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O2(b,a,r,e(s,y),d(s,z))<br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse s</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">p()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// check if s is an ending character (one of ;})] or zero)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;S </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">q()</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">sc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">";})]"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">,*s)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// encode integers up to 127 as bytes with the highest bit set,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// other numbers are appended at the end of z and return index</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (indices &lt;16 correspond to registers, zn-3 is the index in</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the z array of K vals: z[0] is the string and z[1] is NL)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;K1(n){R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">kc(KI==Ax&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">129u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&gt;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">+xi?</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">+xi:(z=jk(z,x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,16+zn-3));}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// expressions: c is the command, a an optional type (or zero)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;K </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">E(I a,I c)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;K r=k1(kc(c)),x; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// store command as char in K array</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// append to r the result of parsing the following</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// expressions separated by semicolons, or a zero if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the expression finishes with ]}; or EOL</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">do</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&nbsp;r=jk(r,x=q()?n(ki(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)):p());W(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">';'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s++);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set given type, or the type result of the expression</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (ie. the type resulting of the last command)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(a?a:t(x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,r);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;K x,y;<br> &nbsp; &nbsp; &nbsp; &nbsp;I a,b;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// character kind switch, if it starts with a minus sign</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// or a dot, it may be a number</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;S(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-c(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'-'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==(a=*s++)?s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'.'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s]:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'.'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a?*s:a)?c(a):</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// in loops, the type of counter variables will be an integer</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">case</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">'N':T[N++]=KI; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// fallthrough</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'W'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,R<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;++s,x=p(),++s, &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// x is the conditional expression</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// (enclosed in parens)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x=k3(kc(a),x,p()), </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// 3rd element is the body</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;N-=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'N'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a, &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// "free" loop variable</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">case</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">'$</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':++s;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">{</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">',R E(0,a)) // return enclosed expression<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// the type of the function is int when getting number of elements<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// of an array (#), float when dividing (%), the type of the<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// expression (t(x)) or of an element when referencing (*)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">',R x=p(),u('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">#</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'==a?KI:'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">%</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'==a?KF:t(x)-8*('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">*</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'==a),k2(kc(a),x)))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">',R E(12,a))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">',x=p(),++s) // parse expression inside parens<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C('</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// transform multiplication by two into right-shift</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'2'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'*'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s,++s,x=p(),u(t(x),k2(kc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'\\'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),x)))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--s;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x=n(Na()) </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse number</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return single character for globals. If followed by [exp],</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// it is an array indexing or a function call, so exp</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// needs to be evaluated by E</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'['</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s?++s,E(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if no type, it is a function call</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;T[b=a-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]?T[b]</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-8</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">: </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// unset high bit for arrays</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(x=G[b],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x=xy, </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// xx is the string, xy the code</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// D[0] and D[1] are stored after RET</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *D=MX(*D,x[xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-2</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; D[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]=MX(D[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">],x[xn</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xu </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// return type of the function</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;a </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the "command" is the var or func name</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;):kc(a)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// default: abort</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// NB: this includes whitespace</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AB(s</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)<br> &nbsp; &nbsp; &nbsp; &nbsp;)<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if next char is ])}; or 0 return what has been parsed till now</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;P(q(),x)<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// else, next character should be a function</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'+'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-c(a=*s++))AB(s</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// for operators with assignment, set highest bit of op character byte</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==*s)++s,a+=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse right argument and get its type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;b=t(y=p());<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// for assignments, set variable type to the type of the</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// right expressions, for divisions set it to float, and</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// else take the largest one (KF&gt;KJ&gt;KI&gt;KC, etc)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;$(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">':'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">==a&amp;&amp;Ax,T[xi-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]=b)b=</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'%'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-a?MX(b,t(x)):KF;<br> &nbsp; &nbsp; &nbsp; &nbsp;K1(f){ </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// cast to float if needed</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R KF-b||KF==t(x)?x:<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Ax&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">126</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&lt;xi?n(kf(xi</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-128</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)):<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;u(KF,k2(kc(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'%'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">),x));<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// if U(a) is not &lt;9, it is a comparison with integer return type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;R </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">u(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">9</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">&lt;U(a)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">?KI:b,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">k3(kc(a)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">f(x)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#660066;font-weight:400">f(y)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">));<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;z=k2(kp(s),NL);<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// inc ref counter of referenced global variable</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(!s[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]&amp;&amp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">26u</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">&gt;*s-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)r1(G[*s-</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'a'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]);<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// function definition</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(r){<br> &nbsp; &nbsp; &nbsp; &nbsp;X(k,k2(r1(zx),u(KI,c2(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">))));<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set type of the x,y,z function arguments</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// more than 3 arguments will produce a segfault because T size is 26</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;N(r-s</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">-1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,L[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">23</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+i]=D[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]++,T[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">23</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">+i]=l(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">" chijefs CHIJEFS"</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,s[i]))<br> &nbsp; &nbsp; &nbsp; &nbsp;s=r;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// parse s and assign to x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;K x=p(); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//o(x);</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// set address of global vars (vars for i&gt;23 are args: x,y,z)</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;N(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">23</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000088;font-weight:400">if</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">(T[i])L[i]=D[KF==T[i]]++)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;I a=t(x); </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// type</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// z will contain:</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; - the evaluated string in x</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; - a function value (string of machine code followed by D[0] and </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; &nbsp; D[1]) with return type a</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// &nbsp; - arguments that do not fit in registers</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp; &nbsp; &nbsp;lnk(zy=u(a,j2(X0(Ax||</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#008800;font-weight:400">'$'</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">-*x?f(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x):v(</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">,x,</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">0</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">)),c3(RET,*D,D[</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#006666;font-weight:400">1</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400">]))));<br> &nbsp; &nbsp;} </span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">//dis(zy);</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// If k points to something, it is a definition, assign to it either</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// the "compiled" function if it is a function definition or the</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// result of evaluating it if it is a variable. Else, return the</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#880000;font-weight:400">// function so it is evaluated and printed later</span><span style="background-color:#ffffff;font-family:&quot;Consolas&quot;;color:#000000;font-weight:400"><br> &nbsp; &nbsp;R k?X(k,r?z:Z0(ev(z))):z;<br>}</span></p></td></tr></tbody></table><p style="padding-top:0pt;margin:0;color:#000000;padding-left:0;font-size:10pt;padding-bottom:10pt;line-height:1.15;font-family:&quot;Arial&quot;;orphans:2;widows:2;height:10pt;text-align:left;padding-right:0"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:&quot;Arial&quot;;font-style:normal"></span></p></div></div></div><script nonce="">window.setTimeout(function() { window.scrollTo(0, 1); }, 0)</script></body></html>